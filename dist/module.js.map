{"version":3,"sources":["../src/module.js"],"names":["angular","_","$","moment","FileExport","MetricsPanelCtrl","transformDataToTable","tablePanelEditor","columnOptionsTab","TableRenderer","Drop","PercentageTablePanelCtrl","$scope","$injector","templateSrv","annotationsSrv","$sanitize","pageIndex","panelDefaults","targets","transform","pageSize","showHeader","styles","type","pattern","alias","dateFormat","unit","decimals","colors","colorMode","thresholds","columns","scroll","fontSize","sort","col","desc","panel","fields","defaults","events","on","onDataReceived","bind","onDataError","onInitEditMode","onInitPanelActions","addEditorTab","actions","push","text","click","datasource","setTimeQueryStart","getAnnotations","dashboard","range","then","data","annotations","err","dataRaw","render","dataList","length","result","error","Error","message","lengthSerieA","rows","lengthSerieB","maxLengthSeries","i","dataFirst","dataSecond","res","table","renderer","isTimezoneUtc","colIndex","exportTableDataToCsv","render_values","scope","elem","attrs","ctrl","pageCount","formaters","getTableHeight","panelHeight","height","appendTableRows","tbodyElem","setTable","empty","html","switchPage","e","el","currentTarget","parseInt","renderPanel","appendPaginationControls","footerElem","Math","ceil","startPage","max","endPage","min","paginationList","activeClass","pageLinkElem","append","panelElem","parents","rootElem","find","css","addClass","tooltip","selector","unbindDestroy","$on","off","renderData","renderingCompleted","templateUrl"],"mappings":"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","file":"module.js","sourcesContent":["///<reference path=\"../../../headers/common.d.ts\" />\n\nimport angular from 'angular';\nimport _ from 'lodash';\nimport $ from 'jquery';\nimport moment from 'moment';\nimport * as FileExport from 'app/core/utils/file_export';\nimport {MetricsPanelCtrl} from 'app/plugins/sdk';\nimport {transformDataToTable} from './transformers';\nimport {tablePanelEditor} from './editor';\nimport {columnOptionsTab} from './column_options';\nimport {TableRenderer} from './renderer';\nimport Drop from 'tether-drop';\n\nclass PercentageTablePanelCtrl extends MetricsPanelCtrl {\n\n  /** @ngInject */\n  constructor($scope, $injector, templateSrv, annotationsSrv, $sanitize) {\n    super($scope, $injector);\n    this.pageIndex = 0;\n\n    this.panelDefaults = {\n        targets: [{}],\n        transform: 'timeseries_to_columns',\n        pageSize: null,\n        showHeader: true,\n        styles: [\n          {\n            type: 'date',\n            pattern: 'Time',\n            alias: 'Time',\n            dateFormat: 'YYYY-MM-DD HH:mm:ss',\n          },\n          {\n            unit: 'short',\n            type: 'number',\n            alias: '',\n            decimals: 2,\n            colors: [\"rgba(245, 54, 54, 0.9)\", \"rgba(237, 129, 40, 0.89)\", \"rgba(50, 172, 45, 0.97)\"],\n            colorMode: null,\n            pattern: '/.*/',\n            thresholds: [],\n          }\n        ],\n        columns: [],\n        scroll: true,\n        fontSize: '100%',\n        sort: {col: 0, desc: true},\n      };\n\n    if (this.panel.styles === void 0) {\n      this.panel.styles = this.panel.columns;\n      this.panel.columns = this.panel.fields;\n      delete this.panel.columns;\n      delete this.panel.fields;\n    }\n\n    _.defaults(this.panel, this.panelDefaults);\n\n    this.events.on('data-received', this.onDataReceived.bind(this));\n    this.events.on('data-error', this.onDataError.bind(this));\n    this.events.on('data-snapshot-load', this.onDataReceived.bind(this));\n    this.events.on('init-edit-mode', this.onInitEditMode.bind(this));\n    this.events.on('init-panel-actions', this.onInitPanelActions.bind(this));\n  }\n\n  onInitEditMode() {\n    this.addEditorTab('Options', tablePanelEditor, 2);\n    this.addEditorTab('Column Styles', columnOptionsTab, 3);\n  }\n\n  onInitPanelActions(actions) {\n    actions.push({text: 'Export CSV', click: 'ctrl.exportCsv()'});\n  }\n\n  issueQueries(datasource) {\n    this.pageIndex = 0;\n\n    if (this.panel.transform === 'annotations') {\n      this.setTimeQueryStart();\n      return this.annotationsSrv.getAnnotations({dashboard: this.dashboard, panel: this.panel, range: this.range})\n      .then(annotations => {\n        return {data: annotations};\n      });\n    }\n\n    return super.issueQueries(datasource);\n  }\n\n  onDataError(err) {\n    this.dataRaw = [];\n    this.render();\n  }\n\n  onDataReceived(dataList) {\n    this.dataRaw = dataList;\n    this.pageIndex = 0;\n\n    // automatically correct transform mode based on data\n    if (this.dataRaw && this.dataRaw.length) {\n      if (this.dataRaw[0].type === 'table') {\n        this.panel.transform = 'table';\n      } else {\n        if (this.dataRaw[0].type === 'docs') {\n          this.panel.transform = 'json';\n        } else {\n          if (this.panel.transform === 'table' || this.panel.transform === 'json') {\n            this.panel.transform = 'timeseries_to_rows';\n          }\n        }\n      }\n    }\n\n    this.render();\n  }\n\n  handleQueryResult(result) {\n    if (result.data.length !== 2) {\"\"\n      let error = new Error();\n      error.message = 'Too many series error';\n      error.data = 'Metric query returns ' + result.data.length + ' series.\\nPercentage stat table panel expects two series.';\n      throw error;\n    }\n\n    const lengthSerieA = result.data[0].rows.length;\n    const lengthSerieB = result.data[1].rows.length;\n    const maxLengthSeries = lengthSerieA > lengthSerieB ? lengthSerieA : lengthSerieB;\n\n    if (lengthSerieA !== lengthSerieB) {\n     let error = new Error();\n     error.message = 'Not same amount of data';\n     error.data = 'Serie A has ' + lengthSerieA + ' while Serie B has ' + lengthSerieB;\n     throw error;\n    }\n\n    for (let i = 0; i < maxLengthSeries; i++) {\n      const dataFirst = result.data[0].rows[i][2];\n      const dataSecond = result.data[1].rows[i][2];\n      const res = (dataFirst / dataSecond) * 100;\n      result.data[0].rows[i][2] = res;\n    }\n    return super.handleQueryResult(result);\n  }\n\n  render() {\n    this.table = transformDataToTable(this.dataRaw, this.panel);\n    this.table.sort(this.panel.sort);\n    this.renderer = new TableRenderer(this.panel, this.table, this.dashboard.isTimezoneUtc(), this.$sanitize, this.templateSrv);\n\n    return super.render(this.table);\n  }\n\n  toggleColumnSort(col, colIndex) {\n    // remove sort flag from current column\n    if (this.table.columns[this.panel.sort.col]) {\n      this.table.columns[this.panel.sort.col].sort = false;\n    }\n\n    if (this.panel.sort.col === colIndex) {\n      if (this.panel.sort.desc) {\n        this.panel.sort.desc = false;\n      } else {\n        this.panel.sort.col = null;\n      }\n    } else {\n      this.panel.sort.col = colIndex;\n      this.panel.sort.desc = true;\n    }\n    this.render();\n  }\n\n  exportCsv() {\n    FileExport.exportTableDataToCsv(this.renderer.render_values());\n  }\n\n  link(scope, elem, attrs, ctrl) {\n    var data;\n    var panel = ctrl.panel;\n    var pageCount = 0;\n    var formaters = [];\n\n    function getTableHeight() {\n      var panelHeight = ctrl.height;\n\n      if (pageCount > 1) {\n        panelHeight -= 26;\n      }\n\n      return (panelHeight - 31) + 'px';\n    }\n\n    function appendTableRows(tbodyElem) {\n      ctrl.renderer.setTable(data);\n      tbodyElem.empty();\n      tbodyElem.html(ctrl.renderer.render(ctrl.pageIndex));\n    }\n\n    function switchPage(e) {\n      var el = $(e.currentTarget);\n      ctrl.pageIndex = (parseInt(el.text(), 10)-1);\n      renderPanel();\n    }\n\n    function appendPaginationControls(footerElem) {\n      footerElem.empty();\n\n      var pageSize = panel.pageSize || 100;\n      pageCount = Math.ceil(data.rows.length / pageSize);\n      if (pageCount === 1) {\n        return;\n      }\n\n      var startPage = Math.max(ctrl.pageIndex - 3, 0);\n      var endPage = Math.min(pageCount, startPage + 9);\n\n      var paginationList = $('<ul></ul>');\n\n      for (var i = startPage; i < endPage; i++) {\n        var activeClass = i === ctrl.pageIndex ? 'active' : '';\n        var pageLinkElem = $('<li><a class=\"table-panel-page-link pointer ' + activeClass + '\">' + (i+1) + '</a></li>');\n        paginationList.append(pageLinkElem);\n      }\n\n      footerElem.append(paginationList);\n    }\n\n    function renderPanel() {\n      var panelElem = elem.parents('.panel');\n      var rootElem = elem.find('.table-panel-scroll');\n      var tbodyElem = elem.find('tbody');\n      var footerElem = elem.find('.table-panel-footer');\n\n      elem.css({'font-size': panel.fontSize});\n      panelElem.addClass('table-panel-wrapper');\n\n      appendTableRows(tbodyElem);\n      appendPaginationControls(footerElem);\n\n      rootElem.css({'max-height': panel.scroll ? getTableHeight() : '' });\n    }\n\n    // hook up link tooltips\n    elem.tooltip({\n      selector: '[data-link-tooltip]'\n    });\n\n    elem.on('click', '.table-panel-page-link', switchPage);\n\n    var unbindDestroy = scope.$on('$destroy', function() {\n      elem.off('click', '.table-panel-page-link');\n      unbindDestroy();\n    });\n\n    ctrl.events.on('render', function(renderData) {\n      data = renderData || data;\n      if (data) {\n        renderPanel();\n      }\n      ctrl.renderingCompleted();\n    });\n  }\n}\n\nPercentageTablePanelCtrl.templateUrl = 'module.html';\n\nexport {\n  PercentageTablePanelCtrl,\n  PercentageTablePanelCtrl as PanelCtrl\n};\n"]}